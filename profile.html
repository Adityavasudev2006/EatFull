<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="icon" type="image/png" sizes="192*192" href="images/logo.png">
    <link rel="icon" type="image/x-icon" sizes="32x32" href="images/favicon.png">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        /* --- Original Profile Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4; /* Light mode default */
            margin-bottom: 100px; /* Ensure space for chatbot button */
        }
    
        /* Navbar styles (Original - Light Mode Base) */
        .navbar {
            background-color: #28282B;
            padding: 10px 20px;
            position: relative;
        }
        .navbar .logo {
            font-size: 24px; color: #ecf0f1; text-transform: uppercase;
            font-weight: bold; text-decoration: none;
        }
        .navbar-menu {
            list-style: none; display: flex; justify-content: flex-end;
            gap: 20px; align-items: center;
        }
        .navbar-menu li { position: relative; }
        .navbar-menu a {
            color: #ecf0f1; text-decoration: none; font-weight: 500;
            text-transform: uppercase; padding: 8px 12px; display: block;
        }
        .navbar-menu a:hover { color: #3498db; }
        .navbar-menu a::after {
            content: ''; position: absolute; width: 0; height: 2px;
            background-color: #3498db; left: 50%; bottom: 0;
            transition: width 0.3s ease, left 0.3s ease; transform: translateX(-50%);
        }
        .navbar-menu a:hover::after { width: 100%; }
        .dropdown-menu {
            position: absolute; background-color: #28282B; top: 100%; left: 0;
            width: 200px; display: none; box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .dropdown-menu a { color: #ecf0f1; padding: 10px; }
        .dropdown-menu a:hover { background-color: white; }
        .dropdown:hover .dropdown-menu { display: block; }
        .search-form { display: flex; gap: 10px; align-items: center; }
        .search-form input { padding: 5px 10px; font-size: 14px; border-radius: 5px; border: none; }
        .search-form button { padding: 6px 12px; background-color: #3498db; color: white; border: none; border-radius: 5px; }
        .menu-toggle { display: none; flex-direction: column; gap: 4px; cursor: pointer; }
        .menu-toggle div { width: 30px; height: 3px; background-color: #ecf0f1; border-radius: 2px; }
    
        /* Profile card styles (Original - Light Mode Base) */
        .profile-card {
            border-radius: 15px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden; margin-top: 30px; margin-bottom: 30px;
        }
        .profile-header {
            background: linear-gradient(135deg, #28282B 0%, #3A3A3E 100%);
            color: white; padding: 30px 0; text-align: center;
        }
        .profile-img {
            width: 120px; height: 120px; border-radius: 50%; object-fit: cover;
            border: 5px solid rgba(255, 255, 255, 0.3); margin-bottom: 15px;
        }
        .profile-body { padding: 30px; background: white; }
        .info-item { padding: 15px 0; border-bottom: 1px solid #eee; }
        .info-item:last-child { border-bottom: none; }
        .info-label { font-weight: 600; color: #555; }
        .info-value { color: #333; }
        .edit-btn {
            background: linear-gradient(135deg, #FF562F 0%, #FF8F50 100%); border: none;
            padding: 10px 25px; font-weight: 600; margin-top: 20px; color: white;
        }
        .edit-btn:hover {
            background: linear-gradient(135deg, #E04B27 0%, #E57D45 100%); transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); color: white;
        }
        .logout-btn {
            background: linear-gradient(135deg, #28282B 0%, #3A3A3E 100%); border: none;
            padding: 10px 25px; font-weight: 600; margin-top: 20px; color: white;
        }
        .logout-btn:hover {
            background: linear-gradient(135deg, #1A1A1B 0%, #2A2A2E 100%); transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); color: white;
        }
        .button-container { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
    
        /* Mobile view styles (Original) */
        @media screen and (max-width: 768px) {
            .navbar-menu {
                position: absolute; top: 50px; right: 20px; background-color: #2c3e50;
                width: 100%; flex-direction: column; gap: 0; padding: 10px 0; display: none;
            }
            .navbar-menu li { width: 100%; text-align: center; }
            .navbar-menu.active { display: flex; }
            .menu-toggle { display: flex; }
            .button-container { flex-direction: column; align-items: center; } /* Stack buttons */
        }
    
        /* --- Theme Toggle Button Styles --- */
        #theme-toggle-button {
          position: fixed; top: 50%; right: 0; transform: translateY(-50%);
          background-color: #3498db; color: white; border: none; padding: 12px 10px;
          border-top-left-radius: 15px; border-bottom-left-radius: 15px; cursor: pointer;
          z-index: 1050; box-shadow: -2px 0px 5px rgba(0, 0, 0, 0.2); transition: background-color 0.3s ease;
          display: flex; align-items: center; justify-content: center; width: 45px; height: 50px;
        }
        #theme-toggle-button:hover { background-color: #2980b9; }
        #theme-toggle-button i { font-size: 1.4em; }
    
        /* --- Dark Theme Global Styles --- */
        body.dark-theme { background-color: #1a1a1a; color: #e0e0e0; }
    
        /* --- Navbar (Dark Theme) --- */
        body.dark-theme .navbar { background-color: #111; border-bottom: 1px solid #333; }
        body.dark-theme .navbar .logo,
        body.dark-theme .navbar-menu a { color: #d0d0d0; }
        body.dark-theme .navbar-menu a:hover { color: #5dade2; }
        body.dark-theme .navbar-menu a::after { background-color: #5dade2; }
        body.dark-theme .dropdown-menu { background-color: #222; box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5); }
        body.dark-theme .dropdown-menu a { color: #d0d0d0; }
        body.dark-theme .dropdown-menu a:hover { background-color: #333; color: #fff; }
        body.dark-theme .search-form input { background-color: #333; color: #eee; border: 1px solid #555; }
        body.dark-theme .search-form input::placeholder { color: #888; }
        body.dark-theme .search-form button { background-color: #5dade2; border-color: #5dade2; }
        body.dark-theme .search-form button:hover { background-color: #76c7f0; border-color: #76c7f0; }
        body.dark-theme .navbar-menu { background-color: #222; } /* For mobile */
    
        /* --- Profile Page Specific Dark Styles --- */
        body.dark-theme .profile-card {
            background-color: #2c2c2c;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        body.dark-theme .profile-header {
            background: linear-gradient(135deg, #111 0%, #28282B 100%);
            color: #e0e0e0;
        }
        body.dark-theme .profile-img {
            border-color: rgba(200, 200, 200, 0.2);
        }
        body.dark-theme .profile-body {
            background: #2c2c2c;
        }
        body.dark-theme .info-item {
            border-bottom-color: #444;
        }
        body.dark-theme .info-label {
            color: #aaa;
        }
        body.dark-theme .info-value {
            color: #e0e0e0;
        }
        /* Optional: Adjust edit button colors for dark mode if desired */
        /* body.dark-theme .edit-btn {
            background: linear-gradient(135deg, #e86a4c 0%, #ffac81 100%);
        }
        body.dark-theme .edit-btn:hover {
            background: linear-gradient(135deg, #d35f41 0%, #f09d70 100%);
        } */
        body.dark-theme .logout-btn {
            background: linear-gradient(135deg, #555 0%, #666 100%);
        }
        body.dark-theme .logout-btn:hover {
            background: linear-gradient(135deg, #444 0%, #555 100%);
        }
    
        /* --- Modal (Dark Theme) --- */
        body.dark-theme .modal-content {
            background-color: #282828; border: 1px solid #444; color: #e0e0e0;
        }
        body.dark-theme .modal-header { border-bottom: 1px solid #444; }
        body.dark-theme .modal-header .btn-close { filter: invert(1) grayscale(100%) brightness(200%); }
        body.dark-theme .modal-title { color: #eee; }
        body.dark-theme .modal-body label { color: #ccc; }
        body.dark-theme .modal-body .form-control {
            background-color: #333; color: #eee; border-color: #555;
        }
        body.dark-theme .modal-body .form-control:read-only { background-color: #444; }
        body.dark-theme .modal-body .form-control::placeholder { color: #888; }
        body.dark-theme .modal-footer { border-top: 1px solid #444; }
        body.dark-theme .modal-footer .btn-secondary {
            background-color: #6c757d; border-color: #6c757d; color: #eee;
        }
        body.dark-theme .modal-footer .btn-secondary:hover {
            background-color: #5a6268; border-color: #545b62;
        }
        body.dark-theme .modal-footer .btn-primary { /* Save Changes Button */
            background: linear-gradient(135deg, #FF562F 0%, #FF8F50 100%); border: none; color: white;
        }
        body.dark-theme .modal-footer .btn-primary:hover {
            background: linear-gradient(135deg, #E04B27 0%, #E57D45 100%); color: white;
        }
    
        /* --- Chatbot (Dark Theme) --- */
        body.dark-theme #chatbot-window { background-color: #282828; border: 1px solid #444; }
        body.dark-theme .chatbot-header { background-color: #333; color: #eee; }
        body.dark-theme #chatbot-messages .message.user { background-color: #3a3a3a; }
        body.dark-theme #chatbot-messages .message.bot { background-color: #4a4a4a; }
        body.dark-theme .chatbot-input-area input { background-color: #333; color: #eee; border: 1px solid #555; }
        body.dark-theme .chatbot-input-area input::placeholder { color: #888; }
        body.dark-theme .chatbot-disclaimer { color: #888; }

                /* --- Loader Styles --- */
        #loader-overlay {
            position: fixed; /* Cover the entire viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 43, 0.85); /* Semi-transparent dark background */
            display: flex; /* Center the spinner */
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Ensure it's on top */
            transition: opacity 0.5s ease-out; /* Smooth fade-out */
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 5px solid transparent; /* Base border */

            /* Mimic the colors from the image (adjust as needed) */
            border-top-color: #E84C3D;    /* Red/Orange */
            border-right-color: #F39C11;  /* Yellow/Orange */
            border-bottom-color: #3598DB; /* Blue */
            border-left-color: #E0A01A;   /* Darker Yellow/Gold */

            animation: spin 1.2s linear infinite; /* Rotation animation */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Blur Effect --- */
        #main-content.blurred {
            filter: blur(5px); /* Apply blur */
            transition: filter 0.3s ease-out; /* Smooth transition for removing blur */
            /* Prevent interaction while blurred */
            pointer-events: none;
            user-select: none;
        }

        /* --- Hide Loader (Utility Class) --- */
        #loader-overlay.hidden {
            opacity: 0;
            pointer-events: none; /* Allow clicks through when hidden */
        }
    </style>
</head>
<body>
    <div id="loader-overlay">
        <div class="loader-spinner"></div>
    </div>
    <!-- NavBar -->
    <div id="main-content">
    <nav class="navbar">
        <a href="./home.html" class="logo">
            <img src="images/logo1.png" alt="EatFull Logo" style="height: 40px;">
        </a>
        <div class="menu-toggle" onclick="toggleMenu()">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <ul class="navbar-menu">
            <li><a href="./home.html">Home</a></li>
            <li><a href="./outlets.html">Outlets</a></li>
            <li class="dropdown">
                <a href="#">Cart</a>
                <ul class="dropdown-menu">
                    <li><a href="./cart.html">View</a></li>
                    <li><a href="#">CheckOut</a></li>
                </ul>
            </li>
            <li><a href="./profile.html">Profile</a></li>
            <li class="search-form">
                <input type="search" placeholder="Search">
                <button>Search</button>
            </li>
        </ul>
    </nav>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="profile-card">
                    <div class="profile-header">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile Image" class="profile-img" id="profileImageDisplay">
                        <h3 id="profileName">Loading...</h3>
                    </div>
                    
                    <div class="profile-body">
                        <div class="info-item row">
                            <div class="col-md-4 info-label">
                                <i class="fas fa-user me-2"></i>Full Name
                            </div>
                            <div class="col-md-8 info-value" id="profileFullName">
                                Loading...
                            </div>
                        </div>
                        
                        <div class="info-item row">
                            <div class="col-md-4 info-label">
                                <i class="fas fa-envelope me-2"></i>Email Address
                            </div>
                            <div class="col-md-8 info-value" id="profileEmail">
                                Loading...
                            </div>
                        </div>
                        
                        <div class="info-item row">
                            <div class="col-md-4 info-label">
                                <i class="fas fa-phone me-2"></i>Phone Number
                            </div>
                            <div class="col-md-8 info-value" id="profilePhone">
                                Loading...
                            </div>
                        </div>
                        
                        <div class="info-item row">
                            <div class="col-md-4 info-label">
                                <i class="fas fa-briefcase me-2"></i>Occupation
                            </div>
                            <div class="col-md-8 info-value" id="profileOccupation">
                                Not specified
                            </div>
                        </div>
                        
                        <div class="button-container">
                            <button class="btn btn-primary edit-btn" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                                <i class="fas fa-edit me-2"></i>Edit Profile
                            </button>
                            <button class="btn logout-btn" id="logoutBtn">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3 row">
                            <label for="firstName" class="col-sm-3 col-form-label">First Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="editFirstName">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="lastName" class="col-sm-3 col-form-label">Last Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="editLastName">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="email" class="col-sm-3 col-form-label">Email</label>
                            <div class="col-sm-9">
                                <input type="email" class="form-control" id="editEmail" readonly>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="phone" class="col-sm-3 col-form-label">Phone</label>
                            <div class="col-sm-9">
                                <input type="tel" class="form-control" id="editPhone">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="occupation" class="col-sm-3 col-form-label">Occupation</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="editOccupation">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="profileImage" class="col-sm-3 col-form-label">Profile Image</label>
                            <div class="col-sm-9">
                                <input class="form-control" type="file" id="editProfileImage" accept="image/*">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveChangesBtn" style="background: linear-gradient(135deg, #FF562F 0%, #FF8F50 100%); border: none;">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    

    <button id="theme-toggle-button" aria-label="Toggle Theme">
        <i id="theme-icon" class="fas fa-sun"></i> <!-- Initial icon -->
    </button>
</div> 

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Firebase configuration (keep as is)
        const firebaseConfig = { apiKey: "AIzaSyAFj0bzxZePc8yhcl-hRbTfYT2zr3VSAT4",
  authDomain: "eatfull-a637b.firebaseapp.com",
  projectId: "eatfull-a637b",
  storageBucket: "eatfull-a637b.firebasestorage.app",
  messagingSenderId: "62197464037",
  appId: "1:62197464037:web:8d7b19cdcbdd7573374d0c",
  measurementId: "G-MX9XXLXTVS"};
    
        // Initialize Firebase (keep as is)
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    
        document.addEventListener('DOMContentLoaded', function() {
            // --- Loader and Blur Logic ---
            const loaderOverlay = document.getElementById('loader-overlay');
            const mainContent = document.getElementById('main-content');
    
            // Add blurred class initially
            mainContent.classList.add('blurred');
    
            let timerFinished = false;
            let dataReady = false;
    
            // Function to hide loader and remove blur
            function hideLoaderAndShowContent() {
                if (timerFinished && dataReady) {
                    // Start fade out animation for loader
                    loaderOverlay.classList.add('hidden');
                    // Remove blur from main content
                    mainContent.classList.remove('blurred');
                    // Optional: Truly remove loader from DOM after fade out
                    setTimeout(() => {
                        if (loaderOverlay) { // Check if it still exists
                           loaderOverlay.style.display = 'none';
                        }
                    }, 500); // Match CSS transition duration
                }
            }
    
            // Set minimum display time for loader (1.5 seconds)
            setTimeout(() => {
                timerFinished = true;
                hideLoaderAndShowContent(); // Check if data is also ready
            }, 1500);
            // --- End Loader Logic ---
    
    
            // Mobile menu toggle functionality (keep as is)
            function toggleMenu() { /* ... */ }
            const menuToggle = document.querySelector('.menu-toggle');
            if (menuToggle) { /* ... */ }
    
            // Logout functionality (keep as is)
            document.getElementById('logoutBtn').addEventListener('click', function() { /* ... */ });
    
            // Check if user is logged in (MODIFIED)
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in, get their data
                    db.collection("users").doc(user.uid).get().then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
    
                            // Update profile page with user data (BEFORE marking dataReady)
                            document.getElementById('profileName').textContent = `${userData.firstName} ${userData.lastName}`;
                            document.getElementById('profileFullName').textContent = `${userData.firstName} ${userData.lastName}`;
                            document.getElementById('profileEmail').textContent = userData.email;
                            document.getElementById('profilePhone').textContent = userData.phoneNumber || 'Not specified'; // Add default
                            document.getElementById('profileOccupation').textContent = userData.occupation || 'Not specified';
    
                            // Populate edit form (BEFORE marking dataReady)
                            document.getElementById('editFirstName').value = userData.firstName || '';
                            document.getElementById('editLastName').value = userData.lastName || '';
                            document.getElementById('editEmail').value = userData.email || '';
                            document.getElementById('editPhone').value = userData.phoneNumber || '';
                            document.getElementById('editOccupation').value = userData.occupation || '';
    
                            // --- Loader Logic ---
                            dataReady = true; // Mark data as ready
                            hideLoaderAndShowContent(); // Check if timer is also finished
                            // --- End Loader Logic ---
    
                        } else {
                            console.log("No user document found!");
                            // Handle case where user exists in auth but not firestore
                            document.getElementById('profileName').textContent = "User Data Not Found";
                            // Clear other fields or show error messages
                            // ...
                            // --- Loader Logic ---
                            dataReady = true; // Still mark as ready to remove loader
                            hideLoaderAndShowContent();
                            // --- End Loader Logic ---
                        }
                    }).catch(error => {
                        console.error("Error getting user document:", error);
                        // Handle error fetching data
                        document.getElementById('profileName').textContent = "Error Loading Data";
                         // Clear other fields or show error messages
                        // ...
                        // --- Loader Logic ---
                        dataReady = true; // Mark as ready even on error to remove loader
                        hideLoaderAndShowContent();
                        // --- End Loader Logic ---
                    });
                } else {
                    // User is not logged in, redirect immediately
                    // No need to wait for loader timer here
                    window.location.href = 'login.html';
                }
            });
    
            // Save Changes Button Logic (keep as is, ensure it works AFTER content is visible)
            const saveBtn = document.getElementById('saveChangesBtn');
            if (saveBtn) {
                 saveBtn.addEventListener('click', function() { /* ... your save logic ... */ });
            }
    
            // Image Upload Logic (Placeholder - Implement image upload/display logic here)
             const fileInput = document.getElementById('editProfileImage');
             if (fileInput) {
                 fileInput.addEventListener('change', function() {
                    // Handle file selection, preview, and potentially upload to Firebase Storage
                    // This example just shows preview
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            // You might want a separate preview image in the modal
                            // Or update the main profile image directly (though saving is separate)
                            // For now, let's update the main display image as a preview
                            document.getElementById('profileImageDisplay').src = e.target.result;
                        };
                        reader.readAsDataURL(this.files[0]);
                    }
                 });
             }
    
        }); // End DOMContentLoaded
    </script>
    <!-- Chatbot JavaScript -->
    <script src="chatbot.js"></script>
    <script src="theme.js"></script>
</body>
</html>